{% extends 'emp/base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% block css %}
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link rel="stylesheet" href="{% static 'external/Searchable-Multi-select-jQuery-Dropdown/jquery.dropdown.css' %}">
<style type="text/css">
	.select2-container{
		width: 100%!important;
	}
	.select2-container--default .select2-selection--multiple{
		border: none!important;
		border: 1px solid #ced4da!important;
	}
</style>
{% endblock %}

{% block content %}
{% if confirm %}
<div class="row">
  <div class="col-sm-8">
    <div class="toast" role="alert" aria-live="assertive" aria-atomic="true" style="max-width: 100%;">
  <div class="toast-header">
    <img src="{{ job.company.logo.url|default_if_none:'#' }}" class="rounded mr-2" style="width: auto;height: 20px;">
    <strong class="mr-auto">{{job.title}}</strong>
    <i class="far fa-check-square" style="color: green;"></i>
    <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="toast-body">
    Your application is successfully submitted !
  </div>
</div>
  </div>
  
</div>

<div class="mt-5">
  <p><b>Below profile details will be sent to the company.</b></p>
  <div class="row">
    <div class="col-md-6" id="confirm"><button id="confirm-btn" type="button" class="btn btn-outline-success" onclick="apply_for_job('{{request.user.student.spk_usr_id}}','{{job_id}}');" >Confirm & Apply</button></div>
    <div class="col-md-6" id="modify"><button type="button" class="btn btn-outline-info" >Modify</button></div>
  </div>
</div>
{% endif %}
<form class="py-5">
	<div class="form-row">
		<div class="col-sm-8">
			<div class="form-group">
	    		<div class="input-group mb-2">
        			<div class="input-group-prepend">
          				<div class="input-group-text"><i class="fas fa-user"></i></div>
        			</div>
        			<input class="form-control" id="" value="{{student.user.get_full_name | default_if_none:''}}" readonly>
      			</div>
  			</div>
		</div>
	</div>
	<div class="form-row">
		<div class="col-lg-4 col-sm-6">
			<div class="form-group">
	    		<div class="input-group mb-2">
        			<div class="input-group-prepend">
          				<div class="input-group-text"><i class="fas fa-envelope"></i></div>
        			</div>
        			<input class="form-control" id="" value="{{student.user.email | default_if_none:''}}" readonly>
      			</div>
  			</div>
		</div>
		<div class="col-lg-4 col-sm-6">
			<div class="form-group">
	    		<div class="input-group mb-2">
        			<div class="input-group-prepend">
          				<div class="input-group-text"><i class="fas fa-phone-alt"></i></div>
        			</div>
        			<input class="form-control" id="" value="{{student.phone | default_if_none:''}}" readonly>
      			</div>
  			</div>
		</div>
	</div>
	<div class="form-row">
		<div class="col-sm-8">
			<div class="form-group">
	    		<div class="input-group mb-2">
        			<div class="input-group-prepend">
          				<div class="input-group-text"><i class="fas fa-home"></i></div>
        			</div>
        			<input class="form-control" id="" value="{{student.address | default_if_none:''}}" readonly>
      			</div>
  			</div>
		</div>
		<div class="col-sm-8">
			<div class="form-group">
	    		<div class="input-group mb-2">
        			<div class="input-group-prepend">
          				<div class="input-group-text"><i class="fas fa-map-marker-alt"></i></div>
        			</div>
        			<input class="form-control" id="" value="{{location}}" readonly></input>
      			</div>
  			</div>
		</div>
	</div>
	<div class="form-row">
		<div class="col-sm-8">
			<div class="form-group">
	    		<div class="input-group mb-2">
        			<div class="input-group-prepend">
          				<div class="input-group-text"><i class="fas fa-landmark"></i></div>
        			</div>
        			<input class="form-control" id="" value="{{student.spk_institute | default_if_none:''}}" readonly>
      			</div>
  			</div>
		</div>
		<div class="col-sm-8">
			<div class="form-group">
	    		<div class="input-group mb-2">
        			<div class="input-group-prepend">
          				<div class="input-group-text"><i class="fas fa-map-marker-alt"></i></div>
        			</div>
        			<input class="form-control" id="" value="{{location}}" readonly></input>
      			</div>
  			</div>
		</div>
	</div>
</form>
<form method="post" id="form-student">
	<div class="form-row">
    	<div class="col-sm-8">
    		<div class="demo mb-3">
          <label>{{ form.skills.label_tag }}</label>
  			<select multiple >
  			{% for skill in skills %}	
  			<option value="{{skill.id}}">{{skill.name}}</option>
  			{% endfor %}
  			</select>
		</div>
    	</div>
		<input type="hidden" id="skills_m" name="skills_m">
    	<div class="col-sm-8">
      		{{ form.about | as_crispy_field }}
    	</div>
    	<div class="col-sm-8">
      		{{ form.experience | as_crispy_field }}
    	</div>
    	<div class="col-sm-4">
    	</div>
    	<div class="col-sm-4">
      		{{ form.linkedin | as_crispy_field }}
    	</div>
		<div class="col-sm-4">
      		{{ form.github | as_crispy_field }}
    	</div>
    	<div class="col-sm-8">
      	{{ form.cover_letter | as_crispy_field }}
    	</div>

    	<!-- Add Education -->
    	<div class="col-sm-4"></div>
    	<div class="col-sm-4">
      	{{ education_form.degree | as_crispy_field }}
    	</div>
    	<div class="col-sm-4">
      	{{ education_form.institute | as_crispy_field }}
    	</div>
    	<div class="col-sm-4"></div>
    	<div class="col-sm-3">
      	{{ education_form.start_year | as_crispy_field }}
    	</div>
    	<div class="col-sm-3">
      	{{ education_form.end_year | as_crispy_field }}
    	</div>
    	<div class="col-sm-2">
      	{{ education_form.gpa | as_crispy_field }}
    	</div>
      <div class="col-12">
        <div class="container" >
          <div class='element' id='div_0'>
            <span class='add'>Add Education</span>
          </div>
        </div>
      </div>
	</div>
	{% csrf_token %}

	<button type="submit" class="btn btn-primary mb-5" id="update_profile" {% if confirm %} style="display: none;" {% endif %}>Update Profile</button>
</form>
{% endblock %}
{% block js %}
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script  src="{% static 'external/Searchable-Multi-select-jQuery-Dropdown/jquery.dropdown.js' %}" ></script>

<script type="text/javascript">

function apply_for_job(spk_user_id,job_id){
    $.ajax({
      url: "/add_student_job_status",
      data: {
        'job_id' : job_id,
        'spk_user_id' : spk_user_id
      },
      dataType: 'json',
      success:function(data){
        var messages = data.msg
        $('.toast').toast({'autohide':false});
        $('.toast').toast('show') ;
    }});
  }

$(document).ready(function() {
  $("#form-student :input").prop("disabled", true);
    var degree_list = [];
    var institute_list = [];
    var start_year_list = [];
    var end_year_list = [];
    var current_index = 0;
    $('.js-example-basic-multiple').select2();
    $('.demo').dropdown({multipleMode:'label'});
    $( "#modify" ).click(function() {
    $("#"+this.id).hide();
    $("#update_profile").show();
    $("#form-student :input").prop("disabled", false);

    });

    $( "#update_profile" ).click(function() {
	 var res = $('.dropdown-selected').text();
	 var res1 = $('.dropdown-chose').text();
	 var x =[];
	 $('.dropdown-chose').each(function(index, obj)
	 {
	  x.push($(this).text());
	 });
	$('#skills_m').val(x);
	degree_id = $('#id_degree').val();
	document.getElementById("id_degree").setAttribute('value',degree_id);
	d=$('#id_degree option:selected').val();
	$('select[name="degree"]').val(d);
	$('#id_degree').val(degree_id);
	institute_id = $('#id_institute').val();
	document.getElementById("id_institute").setAttribute('value',institute_id);
	});

  // Add new element
 $(".add").click(function(){
  // Finding total number of elements added
  var total_element = $(".element").length;
  // last <div> with element class id
  var lastid = $(".element:last").attr("id");
  var split_id = lastid.split("_");
  var nextindex = Number(split_id[1]) + 1;

  var max = 5;
  // Check total number elements
  if(total_element < max ){
   // Adding new div container after last occurance of element class
   $(".element:last").after("<div class='element form-row' id='div_"+ nextindex +"'></div>");
 
   // Adding element to <div>
   $("#div_" + nextindex).append("" 
    
    + "<span id='remove_" 
    + nextindex 
    + "' class='remove'>X</span>"
    + "<div class='col'><select class='form-control degree' id='id_degree_"
    +nextindex +"' "+"name='degree_"+nextindex+"'"
    +" '> </select></div>"
    + "<div class='col'><select class='form-control institute' id='id_institute_"
    +nextindex +"' "+"name='institute_"+nextindex+"'"
    +" '> </select></div>"
    + "<div class='col'><select class='form-control start_year' id='id_start_year_"
    +nextindex +"' "+"name='start_year_"+nextindex+"'"
    +" '> </select></div>"
    + "<div class='col'><select class='form-control end_year' id='id_end_year_"
    +nextindex +"' "+"name='end_year_"+nextindex+"'"
    +" '> </select></div>"
    +"<div class='col'><input type='text' class='form-control gpa' id='id_gpa_"
    +nextindex +"' "+"name='gpa_"+nextindex+"'"
    +" '></div>"
    );

   current_index = nextindex;
 
  }
  if (total_element==1) {
    $.ajax({
      url: "/fetch_education_data",
      data: {
        
      },
      dataType: 'json',
      success:function(data){
        var degrees = data.degrees;
        degree_list = data.degrees;
        institute_list = data.institutes;
        for(i=2000;i<2022;i++){
          start_year_list.push(i);
          end_year_list.push(i+1);
        }
    }});
  } 
 });

$(document).on( 'click', '.degree', function () { 
var options = '';
  $.each(degree_list, function (i, item) {
    options += '<option value="' + item.id + '">' + item.name + '</option>';
});
    degree_vals = $(this).val();
    if (degree_vals==null) {
      $(this).append(options);
    }
    
 });
$(document).on( 'click', '.institute', function () { 
var options = '';
  $.each(institute_list, function (i, item) {
    options += '<option value="' + item.id + '">' + item.institution_name + '</option>';
});
    institute_vals = $(this).val();
    if (institute_vals==null) {
      $(this).append(options);
    }
    
 });

$(document).on( 'click', '.start_year', function () { 
var options = '';
  $.each(start_year_list, function (i, item) {
    options += '<option value="' + item + '">' + item + '</option>';
});
    institute_vals = $(this).val();
    if (institute_vals==null) {
      $(this).append(options);
    }
 });

$(document).on( 'click', '.end_year', function () { 
var options = '';
  $.each(end_year_list, function (i, item) {
    options += '<option value="' + item + '">' + item + '</option>';
});    
    institute_vals = $(this).val();
    if (institute_vals==null) {
      $(this).append(options);
    }
 });

 // Remove element
 $('.container').on('click','.remove',function(){ 
  var id = this.id;
  var split_id = id.split("_");
  var deleteindex = split_id[1];

  $("#div_" + deleteindex).remove();

 }); 

});
</script>

{% endblock %}
